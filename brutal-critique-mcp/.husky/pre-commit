#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Change to the brutal-critique-mcp directory
cd brutal-critique-mcp || exit 1

echo "ğŸ” Running pre-commit checks for brutal-critique-mcp..."

# Run type checking
echo "ğŸ“ Type checking..."
npm run typecheck || {
  echo "âŒ Type checking failed"
  exit 1
}

# Run linting and formatting via lint-staged
echo "ğŸ¨ Running lint-staged (ESLint + Prettier)..."
npx lint-staged || {
  echo "âŒ Linting/formatting failed"
  exit 1
}

# Run tests
echo "ğŸ§ª Running tests..."
npm test -- --passWithNoTests || {
  echo "âŒ Tests failed"
  exit 1
}

# Generate documentation
echo "ğŸ“š Generating documentation..."
npm run docs || {
  echo "âš ï¸  Documentation generation failed (non-blocking)"
}

echo "âœ… All pre-commit checks passed!"